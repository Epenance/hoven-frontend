---
import "../styles/global.css";
import Layout from '../layouts/Layout.astro';
import { strapiClient } from "../clients/strapi";
import Spot from '../components/Spot.astro'

export async function getStaticPaths() {
    const collection = strapiClient.collection('pages')

    const strapiPages = await collection.find({
        populate: {
            Content: {
                populate: '*',
                on: {
                    "spots.hero": {
                        populate:{
                            Link: {
                                populate: ['Page'],
                            }
                        },
                    },
                }
            },
        }
    });

    return strapiPages.data.map(({ Slug, Title, Content }) => {

        console.log(Content)
        return {
            params: { slug: Slug },
            props: { title: Title, content: Content },
        };
    });
}

const { title, content } = Astro.props;
---

<Layout>
    <div class="spots">
        {title}
        {(Array.isArray(content) ? content : []).map((spot: any, idx: number) => (
                <Spot spot={spot} key={idx} />
        ))}
    </div>
</Layout>
